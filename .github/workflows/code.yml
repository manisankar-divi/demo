name: Deploy to Kubernetes

on:
  push:
    branches: [ main ]

jobs:
  deploy:
    name: Deploy to Kubernetes
    runs-on: ubuntu-latest
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
    - name: Test API Connectivity
      run: |
        curl -k https://172.31.3.128:6443/api

    - uses: actions-hub/kubectl@master
      env:
          KUBE_CONFIG: ${{ secrets.KUBE_CONFIG }}
      with:
          args: get pods

    - name: Deploy to K8s
      run: kubectl apply -f ./
